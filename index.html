<!DOCTYPE html>
<!-- saved from url=(0160)https://www.genspark.ai/api/code_sandbox_light/preview/8843dc06-37ba-46c7-8976-45bdd5992aa0/index_v2.html?canvas_history_id=acd2e66f-dcd6-4dd2-8ec7-3d35287256cf -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4DKanKan Meta導入 収益シミュレーション</title>
    <link href="./4DKanKan Meta導入 収益シミュレーション_files/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./4DKanKan Meta導入 収益シミュレーション_files/all.min.css">
    <script src="./4DKanKan Meta導入 収益シミュレーション_files/bootstrap.bundle.min.js.ダウンロード"></script>
    <script src="./4DKanKan Meta導入 収益シミュレーション_files/chart.js.ダウンロード"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 12px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        

        
        /* タブのホバーエフェクト */
        .nav-tabs .nav-link {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-tabs .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -100%;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: left 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover::before,
        .nav-tabs .nav-link.active::before {
            left: 0;
        }
        
        .nav-tabs .nav-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
            border: none;
        }
        
        .company-name-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .company-name-input {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border: 2px solid white;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            width: 100%;
        }
        
        .scenario-selector {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(243,246,249,0.9) 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            animation: zoomIn 0.5s ease-out;
        }
        
        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .scenario-label-large {
            font-size: 28px;
            font-weight: bold;
            color: #495057;
            flex-grow: 1;
            text-align: center;
        }
        
        .scenario-label-large .scenario-name {
            color: #007bff;
            font-size: 32px;
        }
        
        .scenario-buttons {
            display: flex;
            gap: 5px;
        }
        
        .scenario-btn {
            padding: 8px 16px;
            font-weight: bold;
            font-size: 11px;
            border-radius: 25px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .scenario-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .scenario-btn.active {
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            transform: scale(1.1);
            border: 2px solid rgba(255,255,255,0.5);
        }
        
        .editable {
            background-color: #fff3cd !important;
            border: 1px solid #ffeaa7;
        }
        
        .calculated {
            background-color: #f8f9fa !important;
            border: 1px solid #dee2e6;
        }
        
        .currency-input {
            position: relative;
        }
        
        .currency-input::before {
            content: '¥';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #495057;
            font-weight: bold;
            pointer-events: none;
        }
        
        .currency-input input {
            padding-left: 25px;
        }
        
        .negative {
            color: #dc3545 !important;
            font-weight: bold;
        }
        
        .positive {
            color: #28a745 !important;
            font-weight: bold !important;
        }
        
        .recovery-cell {
            background-color: #28a745 !important;
            color: white !important;
            font-weight: bold !important;
            font-size: 13px;
        }
        
        /* 投資回収セルのテキストを確実に白にする */
        .recovery-cell * {
            color: white !important;
        }
        
        .large-project-month {
            background-color: #d4edda !important;
            color: #155724 !important;
        }
        
        .expense-cell {
            color: #dc3545 !important;
        }
        
        .summary-row {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
            color: white !important;
            font-weight: bold;
            font-size: 12px;
            animation: highlightPulse 2s ease-in-out;
        }
        
        @keyframes highlightPulse {
            0%, 100% {
                box-shadow: 0 0 0 rgba(23, 162, 184, 0);
            }
            50% {
                box-shadow: 0 0 20px rgba(23, 162, 184, 0.6);
            }
        }
        
        .summary-row td {
            border-top: 3px solid #0c5460 !important;
            border-bottom: 3px solid #0c5460 !important;
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .table th, .table td {
            padding: 4px;
            font-size: 11px;
            text-align: center;
            vertical-align: middle;
            transition: all 0.2s ease;
        }
        
        .table tbody tr {
            transition: all 0.3s ease;
        }
        
        .table tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.08) !important;
            transform: scale(1.01);
        }
        
        .table input {
            width: 60px;
            padding: 2px;
            text-align: center;
            font-size: 11px;
            border: none;
            background: transparent;
        }
        
        .summary-card {
            margin-bottom: 15px;
        }
        
        .summary-value {
            font-size: 18px;
            font-weight: bold;
            color: #28a745;
        }
        
        .chart-container {
            height: 300px;
            margin-bottom: 20px;
            animation: chartFadeIn 0.8s ease-out;
        }
        
        @keyframes chartFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .card-header {
            border-radius: 15px 15px 0 0 !important;
            font-weight: bold;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
        
        .comparison-table {
            font-size: 14px;
        }
        
        .comparison-table th {
            background-color: #495057;
            color: white;
            padding: 12px;
        }
        
        .comparison-table td {
            padding: 10px;
            font-size: 13px;
        }
        
        .scenario-optimistic {
            background-color: #d1ecf1;
        }
        
        .scenario-realistic {
            background-color: #fff3cd;
        }
        
        .scenario-pessimistic {
            background-color: #f8d7da;
        }
        
        .nav-tabs {
            border-bottom: 3px solid rgba(102, 126, 234, 0.3);
        }
        
        .nav-tabs .nav-link {
            font-size: 13px;
            padding: 12px 20px;
            font-weight: 600;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
        }
        
        .scenario-print-header {
            display: none;
        }
        
        /* タイトル編集エリア */
        .title-section {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .title-editable {
            font-size: 28px;
            font-weight: bold;
            border: none;
            background: transparent;
            text-align: center;
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
            color: #2c3e50;
        }
        
        .title-editable:hover {
            background: rgba(255,255,255,0.5);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: scale(1.02);
        }
        
        .title-editable:focus {
            outline: none;
            background: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transform: scale(1.05);
        }
        
        /* タブ切り替えエフェクト */
        .tab-content {
            perspective: 1000px;
        }
        
        .tab-pane {
            transform-style: preserve-3d;
        }
        
        /* 3Dフリップアニメーション */
        @keyframes flipIn {
            from {
                opacity: 0;
                transform: perspective(1000px) rotateY(-20deg) translateX(-50px);
            }
            to {
                opacity: 1;
                transform: perspective(1000px) rotateY(0deg) translateX(0);
            }
        }
        
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* 各タブに異なるアニメーション */
        #settings.show {
            animation: zoomIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        #simulation.show {
            animation: flipIn 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        #summary.show {
            animation: slideInFromRight 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        #comparison.show {
            animation: zoomIn 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        /* カードのアニメーション */
        .card {
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        /* ボタンのアニメーション */
        .scenario-btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .scenario-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .scenario-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .scenario-btn:hover {
            transform: scale(1.1);
        }
        
        /* 印刷オプション（トグルスイッチ）スタイル */
        .print-option-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .print-option-label {
            font-weight: bold;
            font-size: 16px;
            color: #1976d2;
        }
        
        .print-option-text {
            font-size: 15px;
            color: #424242;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin: 0;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input:checked + .toggle-slider {
            background-color: #4caf50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-status {
            font-size: 15px;
            font-weight: bold;
            color: #4caf50;
            min-width: 50px;
        }
        
        /* 免責事項スタイル */
        .disclaimer-box {
            background: linear-gradient(135deg, #fff3cd 0%, #fff8e1 100%);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
        }
        
        .disclaimer-title {
            color: #856404;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .disclaimer-title i {
            color: #ff9800;
            font-size: 20px;
        }
        
        .disclaimer-list {
            margin: 0;
            padding-left: 20px;
            color: #856404;
            font-size: 13px;
            line-height: 1.8;
        }
        
        .disclaimer-list li {
            margin-bottom: 8px;
        }

        
        /* 印刷用スタイル */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .scenario-selector {
                display: none !important;
            }
            
            .scenario-print-header {
                display: block !important;
                text-align: center;
                padding: 10px 0;
                border-bottom: 2px solid #007bff;
                margin-bottom: 10px;
            }
            
            .scenario-print-header h2 {
                font-size: 18px;
                font-weight: bold;
                color: #007bff;
                margin: 0;
            }
            
            /* サマリータブ専用のヘッダー調整 */
            #summary .scenario-print-header {
                padding: 3px 0 !important;
                margin-bottom: 3px !important;
            }
            
            #summary .scenario-print-header h2 {
                font-size: 13px !important;
                margin: 0 !important;
                line-height: 1.2 !important;
            }
            
            .nav-tabs {
                display: none;
            }
            
            body {
                font-size: 10px;
                margin: 0;
                padding: 10px;
            }
            
            h1 {
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            h4 {
                font-size: 13px;
                margin-bottom: 5px;
            }
            
            /* サマリーの企業名 */
            #summary h4 {
                font-size: 11px !important;
                margin-bottom: 3px !important;
            }
            
            .table {
                font-size: 8px;
                width: 100%;
            }
            
            .table th {
                font-size: 8px;
                padding: 3px 2px;
                line-height: 1.3;
            }
            
            .table td {
                font-size: 8px;
                padding: 3px 2px;
            }
            
            .table input {
                width: 100%;
                font-size: 8px;
                padding: 2px;
            }
            
            /* 印刷時にinputのフォーカス・アウトラインを完全に削除 */
            .table input:focus,
            .table input:active {
                outline: none !important;
                border: none !important;
                box-shadow: none !important;
            }
            
            /* 初期設定: A4縦 */
            .print-a4-portrait {
                page-break-after: always;
            }
            
            .card {
                margin-bottom: 15px;
                page-break-inside: avoid;
            }
            
            .card-header h5 {
                font-size: 16px !important;
                margin: 0;
                padding: 8px !important;
            }
            
            .form-label {
                font-size: 12px !important;
                margin-bottom: 4px;
            }
            
            .form-control {
                font-size: 14px !important;
                padding: 8px !important;
            }
            
            /* 初期設定タブ専用の大きめフォント（1ページに収める）*/
            #settings .card {
                margin-bottom: 10px !important;
            }
            
            #settings .card-header {
                padding: 8px !important;
            }
            
            #settings .card-header h5 {
                font-size: 16px !important;
                line-height: 1.3 !important;
            }
            
            #settings .card-body {
                padding: 10px !important;
            }
            
            #settings .mb-3 {
                margin-bottom: 10px !important;
            }
            
            #settings input.form-control,
            #settings .form-control {
                font-size: 15px !important;
                padding: 8px !important;
                font-weight: bold !important;
                line-height: 1.3 !important;
            }
            
            #settings input.form-control-sm,
            #settings .form-control-sm {
                font-size: 12px !important;
                padding: 5px !important;
                font-weight: bold !important;
            }
            
            #settings label,
            #settings .form-label {
                font-size: 12px !important;
                line-height: 1.2 !important;
            }
            
            /* 初期設定の改ページ防止 */
            #settings {
                page-break-inside: avoid !important;
            }
            
            #settings .row {
                page-break-inside: avoid !important;
            }
            
            /* 初期設定タブの背景色を印刷 */
            #settings .card-header {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings .bg-primary {
                background-color: #007bff !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings .bg-warning {
                background-color: #ffc107 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings .bg-success {
                background-color: #28a745 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings .text-white {
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings .text-dark {
                color: #212529 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* 初期設定のinputフィールドの背景色 */
            #settings input[style*="background:#e7f3ff"] {
                background-color: #e7f3ff !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings input[style*="background:#fff8e1"] {
                background-color: #fff8e1 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            #settings input[style*="background:#e8f5e9"] {
                background-color: #e8f5e9 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* カードの枠線 */
            #settings .card {
                border: 1px solid #ddd !important;
            }
            
            /* 24ヶ月シミュレーション: A3横 */
            @page {
                size: A3 landscape;
                margin: 10mm;
            }
            
            /* Chromeのヘッダー・フッターを非表示 */
            html {
                margin: 0;
            }
            
            body {
                margin: 0 !important;
                padding: 10mm !important;
            }
            
            #simulation .table-responsive {
                overflow: visible;
            }
            
            /* サマリー: A3横（1ページに収める）*/
            #summary .summary-card {
                margin-bottom: 4px !important;
                page-break-inside: avoid;
            }
            
            #summary .card {
                margin-bottom: 4px !important;
                page-break-inside: avoid;
            }
            
            #summary .card-body {
                padding: 5px 6px !important;
            }
            
            #summary .card-header {
                padding: 4px 6px !important;
            }
            
            /* サマリーのh4（企業名）を小さく */
            #summary h4 {
                font-size: 11px !important;
                margin-bottom: 3px !important;
            }
            
            /* サマリーのシナリオヘッダーを小さく */
            #summary .scenario-print-header {
                padding: 5px 0 !important;
                margin-bottom: 5px !important;
            }
            
            #summary .scenario-print-header h2 {
                font-size: 14px !important;
            }
            
            #summary .card-header h5 {
                font-size: 13px !important;
                margin: 0;
                line-height: 1.3 !important;
            }
            
            #summary .card-header h6 {
                font-size: 11px !important;
                margin: 0;
                line-height: 1.3 !important;
            }
            
            #summary .summary-value {
                font-size: 15px !important;
                font-weight: bold !important;
                line-height: 1.4 !important;
            }
            
            #summary h6 {
                font-size: 11px !important;
                margin-bottom: 4px !important;
                font-weight: bold !important;
                line-height: 1.3 !important;
            }
            
            #summary .mb-2,
            #summary .mb-3,
            #summary div.mb-2,
            #summary div.mb-3 {
                margin-bottom: 5px !important;
                font-size: 10px !important;
                line-height: 1.4 !important;
            }
            
            #summary strong {
                font-size: 10px !important;
                font-weight: bold !important;
            }
            
            /* 左側カード（重要指標、年次サマリー、サービス別件数）の行間を広げる */
            #summary .col-md-6:first-child .mb-2,
            #summary .col-md-6:first-child .mb-3 {
                margin-bottom: 6px !important;
            }
            
            #summary .col-md-6:first-child strong {
                font-weight: bold !important;
            }
            
            /* サマリー全体の改ページ防止 */
            #summary {
                page-break-inside: avoid !important;
            }
            
            #summary .row {
                page-break-inside: avoid !important;
            }
            
            /* チャートコンテナを大きく */
            .chart-container {
                height: 190px !important;
                max-height: 190px !important;
                page-break-inside: avoid;
                position: relative;
            }
            
            #summary .chart-container {
                height: 190px !important;
                max-height: 190px !important;
            }
            
            /* 円グラフのcanvasサイズを明示的に指定 */
            #summary .chart-container canvas {
                max-height: 190px !important;
                width: 100% !important;
                height: 190px !important;
            }
            
            /* サマリーの行間を詰める */
            #summary .row {
                margin-bottom: 0;
            }
            
            #summary .col-md-6 {
                padding-left: 3px;
                padding-right: 3px;
            }
            
            #summary .col-12 {
                padding-left: 3px;
                padding-right: 3px;
            }
            
            /* サマリーのグリッドレイアウトを最適化 */
            #summary .mt-3 {
                margin-top: 5px !important;
            }
            
            /* 改ページを防止 */
            #summary {
                page-break-inside: avoid;
            }
            
            /* 円グラフの凡例を小さく */
            #pieChart {
                max-height: 120px !important;
            }
            
            /* シナリオ比較: A3横 */
            #comparison .comparison-table {
                font-size: 10px;
            }
            
            #comparison .comparison-table th {
                font-size: 10px;
                padding: 4px;
            }
            
            #comparison .comparison-table td {
                font-size: 10px;
                padding: 4px;
            }
            
            /* シナリオ比較のレイアウト調整 */
            #comparison h3 {
                font-size: 16px;
                margin-bottom: 8px;
            }
            
            #comparison h4 {
                font-size: 11px;
                margin-bottom: 5px;
            }
            
            #comparison .card {
                margin-bottom: 5px;
            }
            
            #comparison .card-header {
                padding: 3px 6px;
            }
            
            #comparison .card-header h5 {
                font-size: 10px;
                margin: 0;
            }
            
            #comparison .card-header h6 {
                font-size: 9px;
                margin: 0;
            }
            
            #comparison .card-body {
                padding: 4px;
            }
            
            /* 比較グラフのサイズ調整 */
            #comparison .chart-container {
                height: 280px !important;
                max-height: 280px !important;
            }
            
            #comparison .chart-container canvas {
                max-height: 280px !important;
                height: 280px !important;
            }
            
            /* 比較タブの余白調整 */
            #comparison .mt-4 {
                margin-top: 8px !important;
            }
            
            #comparison .row {
                margin-bottom: 0;
            }
            
            #comparison .col-md-6 {
                padding-left: 3px;
                padding-right: 3px;
            }
            
            /* 企業名セクション */
            .company-name-section {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .company-name-input {
                font-size: 18px;
                padding: 5px;
            }
            
            .title-section {
                display: none;
            }
            
            #printTitle {
                display: block !important;
            }
            
            body {
                background: white;
            }
            
            /* カメラ紹介カードの印刷最適化 */
            .card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
            
            .card img {
                max-height: 80px !important;
            }
            
            .card-body {
                padding: 8px !important;
            }
            
            .card h4 {
                font-size: 11px !important;
            }
            
            .card p {
                font-size: 8px !important;
                line-height: 1.3;
            }
            
            /* ロゴサイズ調整 */
            #printTitle img {
                height: 30px !important;
            }
            
            /* 合計行の印刷最適化 */
            .summary-row {
                background-color: #e9ecef !important;
                color: black !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                color-adjust: exact;
            }
            
            /* 投資回収セルの色を印刷時も表示 */
            .recovery-cell {
                background-color: #28a745 !important;
                color: white !important;
                font-weight: bold !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* 投資回収セルの文字を確実に白にする */
            .recovery-cell * {
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* プラス利益の緑色を印刷時も表示 */
            .positive {
                color: #28a745 !important;
                font-weight: bold !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* マイナス利益の赤色を印刷時も表示 */
            .negative {
                color: #dc3545 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* 大規模案件の背景色を印刷時も表示 */
            .large-project-month {
                background-color: #d4edda !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* 費用セルの赤色を印刷時も表示 */
            .expense-cell {
                color: #dc3545 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* テーブルの列幅最適化 */
            .table th:first-child,
            .table td:first-child {
                width: 8%;
            }
            
            .table th:nth-child(n+2):nth-child(-n+6),
            .table td:nth-child(n+2):nth-child(-n+6) {
                width: 4%;
            }
            
            .table th:nth-child(n+7):nth-child(-n+11),
            .table td:nth-child(n+7):nth-child(-n+11) {
                width: 6%;
            }
            
            .table th:nth-child(12),
            .table td:nth-child(12) {
                width: 7%;
            }
            
            .table th:nth-child(n+13),
            .table td:nth-child(n+13) {
                width: 6%;
            }
            
            /* 改ページ制御 */
            .summary-row {
                page-break-inside: avoid;
            }
            
            /* チャートの印刷最適化 */
            .chart-container {
                page-break-inside: avoid;
            }
            
            /* シナリオ名の印刷制御 */
            #summary .scenario-print-header {
                display: block !important;
            }
            
            /* トグルがOFFの時はシナリオ名を非表示 */
            body:not(.show-scenario-name) #summary .scenario-print-header {
                display: none !important;
            }
            
            /* 免責事項の印刷スタイル */
            .disclaimer-box {
                background: #fff3cd !important;
                border: 2px solid #ffc107 !important;
                padding: 10px !important;
                margin-top: 10px !important;
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .disclaimer-title {
                color: #856404 !important;
                font-size: 11px !important;
                font-weight: bold !important;
                margin-bottom: 6px !important;
            }
            
            .disclaimer-title i {
                color: #ff9800 !important;
                font-size: 12px !important;
            }
            
            .disclaimer-list {
                font-size: 9px !important;
                line-height: 1.4 !important;
                color: #856404 !important;
                margin-bottom: 0 !important;
                padding-left: 15px !important;
            }
            
            .disclaimer-list li {
                margin-bottom: 3px !important;
            }
            
            /* サマリーの免責事項をさらに小さく */
            #summary .disclaimer-box {
                padding: 8px !important;
                margin-top: 8px !important;
            }
            
            #summary .disclaimer-title {
                font-size: 10px !important;
                margin-bottom: 5px !important;
            }
            
            #summary .disclaimer-list {
                font-size: 8px !important;
                line-height: 1.3 !important;
            }
            
            #summary .disclaimer-list li {
                margin-bottom: 2px !important;
            }
        }
    </style>
</head>
<body class="">
    <div class="container-fluid py-3">
        <!-- タイトル編集エリア -->
        <div class="title-section no-print">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 20px; flex: 1; justify-content: center;">
                    <img src="./4DKanKan Meta導入 収益シミュレーション_files/a6b4067ce8c7421b26024739b57a48bf" style="height: 50px; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));" alt="JIBANNET">
                    <span style="font-size: 24px; color: #ccc;">×</span>
                    <img src="./4DKanKan Meta導入 収益シミュレーション_files/fcff683fd5bad14182bbe7892db796ad" style="height: 45px; filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));" alt="4DKanKan Meta">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success btn-sm" onclick="exportData()" title="データを保存">
                        <i class="fas fa-download"></i> 保存
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="document.getElementById(&#39;importFile&#39;).click()" title="データを読み込む">
                        <i class="fas fa-upload"></i> 読込
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
            <input type="text" id="pageTitle" class="title-editable" value="4DKanKan Meta フランチャイズ 収益シミュレーション" placeholder="タイトルを入力...">
        </div>
        
        <!-- 印刷用タイトル -->
        <div class="text-center mb-4" id="printTitle" style="display:none;">
            <div style="display: inline-flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                <img src="./4DKanKan Meta導入 収益シミュレーション_files/a6b4067ce8c7421b26024739b57a48bf" style="height: 35px;" alt="JIBANNET">
                <span style="font-size: 20px; color: #999;">×</span>
                <img src="./4DKanKan Meta導入 収益シミュレーション_files/fcff683fd5bad14182bbe7892db796ad" style="height: 30px;" alt="4DKanKan Meta">
            </div>
            <h1 style="font-size: 20px;"><span id="printTitleText">4DKanKan Meta導入 収益シミュレーション</span></h1>
        </div>
        
        <!-- タブナビゲーション -->
        <ul class="nav nav-tabs no-print" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-selected="true">
                    <i class="fas fa-cog"></i> 初期設定・料金表
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="edit-simulation-tab" data-bs-toggle="tab" data-bs-target="#editSimulation" type="button" role="tab" aria-selected="false" tabindex="-1">
                    <i class="fas fa-edit"></i> シミュレーション編集
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="simulation-tab" data-bs-toggle="tab" data-bs-target="#simulation" type="button" role="tab" aria-selected="false" tabindex="-1">
                    <i class="fas fa-calculator"></i> 24ヶ月収益シミュレーション
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab" aria-selected="false" tabindex="-1">
                    <i class="fas fa-chart-pie"></i> サマリー・分析
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="comparison-tab" data-bs-toggle="tab" data-bs-target="#comparison" type="button" role="tab" aria-selected="false" tabindex="-1">
                    <i class="fas fa-balance-scale"></i> シナリオ比較
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabsContent">
            <!-- 初期設定・料金表タブ -->
            <div class="tab-pane fade print-a4-portrait active show" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                <!-- 企業名表示（印刷用） -->
                <div class="text-center mt-2">
                    <h4 id="settingsCompanyName" class="text-primary">【 株式会社シムラ 様 専用シミュレーション 】</h4>
                </div>
                
                <!-- カメラ紹介カード -->
                <div class="card mb-4" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid rgba(102, 126, 234, 0.3); position: relative; overflow: hidden;">
                    <img src="./4DKanKan Meta導入 収益シミュレーション_files/ff4c01eade0c35b7051065493fbf2fa7" style="position: absolute; right: -50px; top: 50%; transform: translateY(-50%); height: 200px; opacity: 0.15; z-index: 0;" alt="4DKanKan Meta Camera">
                    <div class="card-body" style="position: relative; z-index: 1;">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="./4DKanKan Meta導入 収益シミュレーション_files/a6b4067ce8c7421b26024739b57a48bf" style="height: 50px; margin-right: 15px;" alt="JIBANNET">
                                    <div>
                                        <h4 style="color: #667eea; font-weight: bold; margin-bottom: 5px;">
                                            <i class="fas fa-video"></i> 4DKanKan Meta カメラシステム
                                        </h4>
                                        <p style="font-size: 12px; color: #6c757d; margin-bottom: 0;">Powered by JIBANNET</p>
                                    </div>
                                </div>
                                <p style="font-size: 14px; color: #495057; margin-bottom: 10px;">
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i> 次世代3Dスキャン技術搭載<br>
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i> 高精度VR空間データ生成<br>
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i> フランチャイズ事業で収益化
                                </p>
                                <p style="font-size: 12px; color: #6c757d; margin-bottom: 0;">
                                    このシミュレーションツールで、貴社のビジネスプランを詳細に分析できます。
                                </p>
                            </div>
                            <div class="col-md-4 text-center">
                                <img src="./4DKanKan Meta導入 収益シミュレーション_files/ff4c01eade0c35b7051065493fbf2fa7" style="max-width: 100%; height: auto; max-height: 150px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));" alt="4DKanKan Meta Camera">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 企業名入力欄 -->
                <div class="company-name-section">
                    <input type="text" id="companyName" class="company-name-input" placeholder="株式会社〇〇〇〇" value="">
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5><i class="fas fa-yen-sign"></i> 初期投資</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="initialFeeLabel" class="form-control form-control-sm mb-1" value="初期加盟金" style="font-weight:bold; background:#e7f3ff;"></label>
                                    <input type="text" id="initialFee" class="form-control editable" value="¥1,500,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="equipmentFeeLabel" class="form-control form-control-sm mb-1" value="カメラ・研修費" style="font-weight:bold; background:#e7f3ff;"></label>
                                    <input type="text" id="equipmentFee" class="form-control editable" value="¥3,550,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="totalInitialInvestmentLabel" class="form-control form-control-sm mb-1" value="合計初期投資" style="font-weight:bold; background:#e7f3ff;"></label>
                                    <input type="text" id="totalInitialInvestment" class="form-control calculated" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5><i class="fas fa-calendar-alt"></i> 月額固定費</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="cloudFeeLabel" class="form-control form-control-sm mb-1" value="クラウド利用料" style="font-weight:bold; background:#fff8e1;"></label>
                                    <input type="text" id="cloudFee" class="form-control editable" value="¥20,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="geoWebFeeLabel" class="form-control form-control-sm mb-1" value="ジオWEB" style="font-weight:bold; background:#fff8e1;"></label>
                                    <input type="text" id="geoWebFee" class="form-control editable" value="¥6,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="appFeeLabel" class="form-control form-control-sm mb-1" value="アプリ" style="font-weight:bold; background:#fff8e1;"></label>
                                    <input type="text" id="appFee" class="form-control editable" value="¥9,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="totalMonthlyFixedCostLabel" class="form-control form-control-sm mb-1" value="合計月額固定費" style="font-weight:bold; background:#fff8e1;"></label>
                                    <input type="text" id="totalMonthlyFixedCost" class="form-control calculated" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5><i class="fas fa-tags"></i> サービス料金表</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="survey3dPriceLabel" class="form-control form-control-sm mb-1" value="3D測量（加盟店利益/件）" style="font-weight:bold; background:#e8f5e9;"></label>
                                    <input type="text" id="survey3dPrice" class="form-control editable" value="¥80,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="survey3dCostLabel" class="form-control form-control-sm mb-1" value="3D図面作成費（経費/件）" style="font-weight:bold; background:#e8f5e9;"></label>
                                    <input type="text" id="survey3dCost" class="form-control editable" value="¥30,000">
                                </div>
                                <hr>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="vrSmallPriceLabel" class="form-control form-control-sm mb-1" value="VR小規模" style="font-weight:bold; background:#e8f5e9;"></label>
                                    <input type="text" id="vrSmallPrice" class="form-control editable" value="¥80,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="vrMediumPriceLabel" class="form-control form-control-sm mb-1" value="VR中規模" style="font-weight:bold; background:#e8f5e9;"></label>
                                    <input type="text" id="vrMediumPrice" class="form-control editable" value="¥250,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="vrLargePriceLabel" class="form-control form-control-sm mb-1" value="VR大規模" style="font-weight:bold; background:#e8f5e9;"></label>
                                    <input type="text" id="vrLargePrice" class="form-control editable" value="¥500,000">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><input type="text" id="headquarterPriceLabel" class="form-control form-control-sm mb-1" value="本部案件" style="font-weight:bold; background:#e8f5e9;"></label>
                                    <input type="text" id="headquarterPrice" class="form-control editable" value="¥18,000">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- シミュレーション編集タブ（新規追加） -->
            <div class="tab-pane fade" id="editSimulation" role="tabpanel" aria-labelledby="edit-simulation-tab">
                <div class="text-center mt-2">
                    <h4 id="editSimulationCompanyName" class="text-primary">【 株式会社シムラ 様 専用シミュレーション 】</h4>
                </div>
                
                <!-- 印刷用ヘッダー -->
                <div class="scenario-print-header">
                    <h2>【 提案シミュレーション 】</h2>
                </div>
                
                <div class="mt-3">
                    <div class="alert alert-info no-print">
                        <i class="fas fa-info-circle"></i> ここで編集した数値が、「24ヶ月収益シミュレーション」の【現実的】に自動反映されます。
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-sm" id="editSimulationTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>月</th>
                                    <th>3D測量<br>件数</th>
                                    <th>VR小規模<br>件数</th>
                                    <th>VR中規模<br>件数</th>
                                    <th>VR大規模<br>件数</th>
                                    <th>本部案件<br>件数</th>
                                    <th>3D測量<br>売上</th>
                                    <th>VR小規模<br>売上</th>
                                    <th>VR中規模<br>売上</th>
                                    <th>VR大規模<br>売上</th>
                                    <th>本部案件<br>売上</th>
                                    <th>売上合計</th>
                                    <th>月額固定費</th>
                                    <th>3D図面<br>作成費</th>
                                    <th>月間利益</th>
                                    <th>累積利益</th>
                                </tr>
                            </thead>
                            <tbody id="editSimulationTableBody"><tr>
                    <td>1ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(0, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(0, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(0, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(0, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(0, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative">¥-20,000</td>
                </tr><tr>
                    <td>2ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(1, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(1, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(1, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(1, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(1, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative">¥-40,000</td>
                </tr><tr>
                    <td>3ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(2, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(2, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(2, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(2, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(2, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative">¥-60,000</td>
                </tr><tr>
                    <td>4ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(3, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(3, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(3, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(3, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(3, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative">¥-80,000</td>
                </tr><tr>
                    <td>5ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(4, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(4, 1, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(4, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(4, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(4, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive">¥200,000</td>
                </tr><tr>
                    <td>6ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(5, 0, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(5, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(5, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(5, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(5, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥680,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥660,000</td>
                    <td class="calculated positive">¥860,000</td>
                </tr><tr>
                    <td>7ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(6, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(6, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(6, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(6, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(6, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated positive">¥840,000</td>
                </tr><tr>
                    <td>8ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(7, 0, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(7, 1, this.value)"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateEditMonthlyData(7, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(7, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(7, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥680,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥660,000</td>
                    <td class="calculated positive">¥1,500,000</td>
                </tr><tr>
                    <td>9ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(8, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(8, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(8, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(8, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(8, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive">¥2,080,000</td>
                </tr><tr>
                    <td>10ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(9, 0, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(9, 1, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(9, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(9, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(9, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥380,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥360,000</td>
                    <td class="calculated positive">¥2,440,000</td>
                </tr><tr>
                    <td>11ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(10, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(10, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(10, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(10, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(10, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated recovery-cell">¥3,020,000</td>
                </tr><tr>
                    <td>12ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(11, 0, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(11, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(11, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(11, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(11, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥80,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥60,000</td>
                    <td class="calculated positive">¥3,080,000</td>
                </tr><tr class="summary-row">
                        <td><strong>1年目合計</strong></td>
                        <td><strong>0</strong></td>
                        <td><strong>4</strong></td>
                        <td><strong>4</strong></td>
                        <td><strong>3</strong></td>
                        <td><strong>0</strong></td>
                        <td><strong>¥0</strong></td>
                        <td><strong>¥320,000</strong></td>
                        <td><strong>¥1,200,000</strong></td>
                        <td><strong>¥1,800,000</strong></td>
                        <td><strong>¥0</strong></td>
                        <td><strong>¥3,320,000</strong></td>
                        <td><strong>-¥240,000</strong></td>
                        <td><strong>-¥0</strong></td>
                        <td><strong>¥3,080,000</strong></td>
                        <td><strong>¥3,080,000</strong></td>
                    </tr><tr>
                    <td>13ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(12, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(12, 1, this.value)"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateEditMonthlyData(12, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(12, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(12, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive">¥3,660,000</td>
                </tr><tr>
                    <td>14ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(13, 0, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(13, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(13, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(13, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(13, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥80,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥60,000</td>
                    <td class="calculated positive">¥3,720,000</td>
                </tr><tr>
                    <td>15ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(14, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(14, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(14, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(14, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(14, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive">¥4,300,000</td>
                </tr><tr>
                    <td>16ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(15, 0, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(15, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(15, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(15, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(15, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥80,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥60,000</td>
                    <td class="calculated positive">¥4,360,000</td>
                </tr><tr>
                    <td>17ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(16, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(16, 1, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(16, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(16, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(16, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive">¥4,640,000</td>
                </tr><tr>
                    <td>18ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(17, 0, this.value)"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateEditMonthlyData(17, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(17, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(17, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(17, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥160,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥140,000</td>
                    <td class="calculated positive">¥4,780,000</td>
                </tr><tr>
                    <td>19ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(18, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(18, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(18, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(18, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(18, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive">¥5,360,000</td>
                </tr><tr>
                    <td>20ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(19, 0, this.value)"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateEditMonthlyData(19, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(19, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(19, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(19, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥160,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥140,000</td>
                    <td class="calculated positive">¥5,500,000</td>
                </tr><tr>
                    <td>21ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(20, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(20, 1, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(20, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(20, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(20, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive">¥5,780,000</td>
                </tr><tr>
                    <td>22ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(21, 0, this.value)"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateEditMonthlyData(21, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(21, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(21, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(21, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥760,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥740,000</td>
                    <td class="calculated positive">¥6,520,000</td>
                </tr><tr>
                    <td>23ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(22, 0, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(22, 1, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(22, 2, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(22, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(22, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive">¥6,800,000</td>
                </tr><tr>
                    <td>24ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(23, 0, this.value)"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateEditMonthlyData(23, 1, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(23, 2, this.value)"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateEditMonthlyData(23, 3, this.value)"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateEditMonthlyData(23, 4, this.value)"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥760,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥740,000</td>
                    <td class="calculated positive">¥7,540,000</td>
                </tr><tr class="summary-row">
                <td><strong>2年目合計</strong></td>
                <td><strong>0</strong></td>
                <td><strong>10</strong></td>
                <td><strong>5</strong></td>
                <td><strong>4</strong></td>
                <td><strong>0</strong></td>
                <td><strong>¥0</strong></td>
                <td><strong>¥800,000</strong></td>
                <td><strong>¥1,500,000</strong></td>
                <td><strong>¥2,400,000</strong></td>
                <td><strong>¥0</strong></td>
                <td><strong>¥4,700,000</strong></td>
                <td><strong>-¥240,000</strong></td>
                <td><strong>-¥0</strong></td>
                <td><strong>¥4,460,000</strong></td>
                <td><strong>¥7,540,000</strong></td>
            </tr></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 免責事項 -->
                <div class="disclaimer-box mt-4">
                    <h6 class="disclaimer-title"><i class="fas fa-exclamation-triangle"></i> 免責事項</h6>
                    <ol class="disclaimer-list">
                        <li>本シミュレーションは情報提供を目的としており、実際の収益を保証するものではありません。</li>
                        <li>記載された数値は一定の前提条件に基づく予測値であり、将来の業績を約束するものではありません。</li>
                        <li>実際の売上・利益は、市場環境、競合状況、経営努力、地域特性等により変動します。</li>
                        <li>機器購入や加盟契約の判断は、本シミュレーションのみに依拠せず、十分な検討の上で行ってください。</li>
                        <li>本シミュレーションの利用により生じた損害について、当社は一切の責任を負いません。</li>
                    </ol>
                </div>
            </div>
            
            <!-- 24ヶ月収益シミュレーションタブ -->
            <div class="tab-pane fade" id="simulation" role="tabpanel" aria-labelledby="simulation-tab">
                <div class="text-center mt-2">
                    <h4 id="simulationCompanyName" class="text-primary">【 株式会社シムラ 様 専用シミュレーション 】</h4>
                </div>
                
                <!-- 印刷用シナリオヘッダー -->
                <div class="scenario-print-header">
                    <h2 id="simulationScenarioPrint">【 現実的シナリオ 】</h2>
                </div>
                
                <!-- シナリオ選択 -->
                <div class="scenario-selector no-print">
                    <div class="scenario-label-large">
                        シナリオ: <span class="scenario-name" id="simulationScenarioName">現実的</span>
                    </div>
                    <div class="scenario-buttons">
                        <button class="btn btn-success scenario-btn" onclick="switchScenario(&#39;optimistic&#39;)">
                            <i class="fas fa-smile"></i> 楽観的
                        </button>
                        <button class="btn btn-info scenario-btn active" onclick="switchScenario(&#39;realistic&#39;)">
                            <i class="fas fa-chart-line"></i> 現実的
                        </button>
                        <button class="btn btn-warning scenario-btn" onclick="switchScenario(&#39;pessimistic&#39;)">
                            <i class="fas fa-frown"></i> 悲観的
                        </button>
                    </div>
                </div>
                
                <div class="mt-3">
                    <div class="alert alert-warning no-print" id="realisticReadonlyAlert" style="display: none;">
                        <i class="fas fa-lock"></i> 現実的シナリオのデータは「シミュレーション編集」タブで編集してください。こちらは読み取り専用です。
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-sm" id="simulationTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>月</th>
                                    <th>3D測量<br>件数</th>
                                    <th>VR小規模<br>件数</th>
                                    <th>VR中規模<br>件数</th>
                                    <th>VR大規模<br>件数</th>
                                    <th>本部案件<br>件数</th>
                                    <th>3D測量<br>売上</th>
                                    <th>VR小規模<br>売上</th>
                                    <th>VR中規模<br>売上</th>
                                    <th>VR大規模<br>売上</th>
                                    <th>本部案件<br>売上</th>
                                    <th>売上合計</th>
                                    <th>月額固定費</th>
                                    <th>3D図面<br>作成費</th>
                                    <th>月間利益</th>
                                    <th>累積利益</th>
                                </tr>
                            </thead>
                            <tbody id="simulationTableBody"><tr class="">
                    <td>1ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(0, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(0, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(0, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(0, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(0, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative ">¥-20,000</td>
                </tr><tr class="">
                    <td>2ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(1, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(1, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(1, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(1, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(1, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative ">¥-40,000</td>
                </tr><tr class="">
                    <td>3ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(2, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(2, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(2, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(2, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(2, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative ">¥-60,000</td>
                </tr><tr class="">
                    <td>4ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(3, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(3, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(3, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(3, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(3, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated negative ">¥-80,000</td>
                </tr><tr class="">
                    <td>5ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(4, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(4, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(4, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(4, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(4, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive ">¥200,000</td>
                </tr><tr class="large-project-month">
                    <td>6ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(5, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(5, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(5, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(5, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(5, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥680,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥660,000</td>
                    <td class="calculated positive ">¥860,000</td>
                </tr><tr class="">
                    <td>7ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(6, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(6, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(6, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(6, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(6, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥0</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated negative">¥-20,000</td>
                    <td class="calculated positive ">¥840,000</td>
                </tr><tr class="">
                    <td>8ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(7, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(7, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateMonthlyData(7, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(7, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(7, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥680,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥660,000</td>
                    <td class="calculated positive ">¥1,500,000</td>
                </tr><tr class="large-project-month">
                    <td>9ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(8, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(8, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(8, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(8, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(8, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive ">¥2,080,000</td>
                </tr><tr class="">
                    <td>10ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(9, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(9, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(9, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(9, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(9, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥380,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥360,000</td>
                    <td class="calculated positive ">¥2,440,000</td>
                </tr><tr class="large-project-month">
                    <td>11ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(10, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(10, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(10, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(10, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(10, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive recovery-cell">¥3,020,000</td>
                </tr><tr class="">
                    <td>12ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(11, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(11, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(11, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(11, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(11, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥80,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥60,000</td>
                    <td class="calculated positive ">¥3,080,000</td>
                </tr><tr class="summary-row">
                        <td><strong>1年目合計</strong></td>
                        <td><strong>0</strong></td>
                        <td><strong>4</strong></td>
                        <td><strong>4</strong></td>
                        <td><strong>3</strong></td>
                        <td><strong>0</strong></td>
                        <td><strong>¥0</strong></td>
                        <td><strong>¥320,000</strong></td>
                        <td><strong>¥1,200,000</strong></td>
                        <td><strong>¥1,800,000</strong></td>
                        <td><strong>¥0</strong></td>
                        <td><strong>¥3,320,000</strong></td>
                        <td><strong>-¥240,000</strong></td>
                        <td><strong>-¥0</strong></td>
                        <td><strong>¥3,080,000</strong></td>
                        <td><strong>¥3,080,000</strong></td>
                    </tr><tr class="">
                    <td>13ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(12, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(12, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateMonthlyData(12, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(12, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(12, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive ">¥3,660,000</td>
                </tr><tr class="">
                    <td>14ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(13, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(13, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(13, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(13, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(13, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥80,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥60,000</td>
                    <td class="calculated positive ">¥3,720,000</td>
                </tr><tr class="large-project-month">
                    <td>15ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(14, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(14, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(14, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(14, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(14, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive ">¥4,300,000</td>
                </tr><tr class="">
                    <td>16ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(15, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(15, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(15, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(15, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(15, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥80,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥80,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥60,000</td>
                    <td class="calculated positive ">¥4,360,000</td>
                </tr><tr class="">
                    <td>17ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(16, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(16, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(16, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(16, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(16, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive ">¥4,640,000</td>
                </tr><tr class="">
                    <td>18ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(17, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateMonthlyData(17, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(17, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(17, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(17, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥160,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥140,000</td>
                    <td class="calculated positive ">¥4,780,000</td>
                </tr><tr class="large-project-month">
                    <td>19ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(18, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(18, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(18, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(18, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(18, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥600,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥580,000</td>
                    <td class="calculated positive ">¥5,360,000</td>
                </tr><tr class="">
                    <td>20ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(19, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateMonthlyData(19, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(19, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(19, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(19, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥160,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥140,000</td>
                    <td class="calculated positive ">¥5,500,000</td>
                </tr><tr class="">
                    <td>21ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(20, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(20, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(20, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(20, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(20, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive ">¥5,780,000</td>
                </tr><tr class="large-project-month">
                    <td>22ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(21, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateMonthlyData(21, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(21, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(21, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(21, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥760,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥740,000</td>
                    <td class="calculated positive ">¥6,520,000</td>
                </tr><tr class="">
                    <td>23ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(22, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(22, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(22, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(22, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(22, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥300,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥300,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥280,000</td>
                    <td class="calculated positive ">¥6,800,000</td>
                </tr><tr class="large-project-month">
                    <td>24ヶ月目</td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(23, 0, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="2" class="editable" onchange="updateMonthlyData(23, 1, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(23, 2, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="1" class="editable" onchange="updateMonthlyData(23, 3, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td><input type="number" value="0" class="editable" onchange="updateMonthlyData(23, 4, this.value)" readonly="" style="background-color: #f8f9fa; cursor: not-allowed;"></td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥160,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated">¥600,000</td>
                    <td class="calculated">¥0</td>
                    <td class="calculated"><strong>¥760,000</strong></td>
                    <td class="calculated expense-cell">-¥20,000</td>
                    <td class="calculated expense-cell">-¥0</td>
                    <td class="calculated positive">¥740,000</td>
                    <td class="calculated positive ">¥7,540,000</td>
                </tr><tr class="summary-row">
                <td><strong>2年目合計</strong></td>
                <td><strong>0</strong></td>
                <td><strong>10</strong></td>
                <td><strong>5</strong></td>
                <td><strong>4</strong></td>
                <td><strong>0</strong></td>
                <td><strong>¥0</strong></td>
                <td><strong>¥800,000</strong></td>
                <td><strong>¥1,500,000</strong></td>
                <td><strong>¥2,400,000</strong></td>
                <td><strong>¥0</strong></td>
                <td><strong>¥4,700,000</strong></td>
                <td><strong>-¥240,000</strong></td>
                <td><strong>-¥0</strong></td>
                <td><strong>¥4,460,000</strong></td>
                <td><strong>¥7,540,000</strong></td>
            </tr></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 免責事項 -->
                <div class="disclaimer-box mt-4">
                    <h6 class="disclaimer-title"><i class="fas fa-exclamation-triangle"></i> 免責事項</h6>
                    <ol class="disclaimer-list">
                        <li>本シミュレーションは情報提供を目的としており、実際の収益を保証するものではありません。</li>
                        <li>記載された数値は一定の前提条件に基づく予測値であり、将来の業績を約束するものではありません。</li>
                        <li>実際の売上・利益は、市場環境、競合状況、経営努力、地域特性等により変動します。</li>
                        <li>機器購入や加盟契約の判断は、本シミュレーションのみに依拠せず、十分な検討の上で行ってください。</li>
                        <li>本シミュレーションの利用により生じた損害について、当社は一切の責任を負いません。</li>
                    </ol>
                </div>
            </div>

            <!-- サマリー・分析タブ -->
            <div class="tab-pane fade" id="summary" role="tabpanel" aria-labelledby="summary-tab">
                <div class="text-center mt-2">
                    <h4 id="summaryCompanyName" class="text-primary">【 株式会社シムラ 様 専用シミュレーション 】</h4>
                </div>
                
                <!-- 印刷用シナリオヘッダー -->
                <div class="scenario-print-header">
                    <h2 id="summaryScenarioPrint" style="opacity: 0.3;">【 現実的シナリオ 】</h2>
                </div>
                
                <!-- シナリオ選択 -->
                <div class="scenario-selector no-print">
                    <div class="scenario-label-large">
                        シナリオ: <span class="scenario-name" id="summaryScenarioName">現実的</span>
                    </div>
                    <div class="scenario-buttons">
                        <button class="btn btn-success scenario-btn" onclick="switchScenario(&#39;optimistic&#39;)">
                            <i class="fas fa-smile"></i> 楽観的
                        </button>
                        <button class="btn btn-info scenario-btn active" onclick="switchScenario(&#39;realistic&#39;)">
                            <i class="fas fa-chart-line"></i> 現実的
                        </button>
                        <button class="btn btn-warning scenario-btn" onclick="switchScenario(&#39;pessimistic&#39;)">
                            <i class="fas fa-frown"></i> 悲観的
                        </button>
                    </div>
                </div>
                
                <!-- 印刷オプション（トグルスイッチ） -->
                <div class="print-option-container no-print">
                    <span class="print-option-label">印刷オプション：</span>
                    <span class="print-option-text">シナリオ名</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showScenarioNameToggle" checked="" onchange="toggleScenarioName()">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-status" id="toggleStatus" style="color: rgb(244, 67, 54);">非表示</span>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card summary-card">
                            <div class="card-header bg-info text-white">
                                <h5><i class="fas fa-trophy"></i> 重要指標（2年間）</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <strong>初期投資額</strong><br>
                                            <span class="summary-value" id="summaryInitialInvestment">¥3,000,000</span>
                                        </div>
                                        <div class="mb-3">
                                            <strong>投資回収月</strong><br>
                                            <span class="summary-value" id="summaryRecoveryMonth">11ヶ月目</span>
                                        </div>
                                        <div class="mb-3">
                                            <strong>回収時点の純利益</strong><br>
                                            <span class="summary-value" id="summaryRecoveryProfit">¥20,000</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <strong>2年累積利益</strong><br>
                                            <span class="summary-value" id="summaryTotalProfit">¥7,540,000</span>
                                        </div>
                                        <div class="mb-3">
                                            <strong>2年純利益</strong><br>
                                            <span class="summary-value" id="summaryNetProfit">¥4,540,000</span>
                                        </div>
                                        <div class="mb-3">
                                            <strong>投資回収率（2年）</strong><br>
                                            <span class="summary-value" id="summaryROI">151%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card summary-card">
                            <div class="card-header bg-secondary text-white">
                                <h5><i class="fas fa-chart-bar"></i> 年次サマリー</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h6>1年目</h6>
                                        <div class="mb-2">
                                            年間売上: <strong id="year1Sales">¥3,320,000</strong>
                                        </div>
                                        <div class="mb-2">
                                            年間固定費: <strong id="year1FixedCost">¥240,000</strong>
                                        </div>
                                        <div class="mb-2">
                                            年間利益: <strong id="year1Profit">¥3,080,000</strong>
                                        </div>
                                        <div class="mb-2">
                                            累積利益: <strong id="year1Cumulative">¥3,080,000</strong>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <h6>2年目</h6>
                                        <div class="mb-2">
                                            年間売上: <strong id="year2Sales">¥4,700,000</strong>
                                        </div>
                                        <div class="mb-2">
                                            年間固定費: <strong id="year2FixedCost">¥240,000</strong>
                                        </div>
                                        <div class="mb-2">
                                            年間利益: <strong id="year2Profit">¥4,460,000</strong>
                                        </div>
                                        <div class="mb-2">
                                            累積利益: <strong id="year2Cumulative">¥7,540,000</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card summary-card">
                            <div class="card-header bg-dark text-white">
                                <h5><i class="fas fa-list"></i> サービス別件数（2年間合計）</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-2">3D測量（自社）: <strong id="totalSurvey3d">0件</strong></div>
                                        <div class="mb-2">VR小規模: <strong id="totalVrSmall">14件</strong></div>
                                        <div class="mb-2">VR中規模: <strong id="totalVrMedium">9件</strong></div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-2">VR大規模: <strong id="totalVrLarge">7件</strong></div>
                                        <div class="mb-2">本部案件: <strong id="totalHeadquarter">0件</strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>月次売上推移</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="salesChart" style="box-sizing: border-box; display: block; height: 300px; width: 892.5px;" width="892" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>累積利益推移</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="profitChart" style="box-sizing: border-box; display: block; height: 300px; width: 892.5px;" width="892" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>サービス別売上構成</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="pieChart" style="box-sizing: border-box; display: block; height: 300px; width: 892.5px;" width="892" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 免責事項 -->
                <div class="disclaimer-box mt-4">
                    <h6 class="disclaimer-title"><i class="fas fa-exclamation-triangle"></i> 免責事項</h6>
                    <ol class="disclaimer-list">
                        <li>本シミュレーションは情報提供を目的としており、実際の収益を保証するものではありません。</li>
                        <li>記載された数値は一定の前提条件に基づく予測値であり、将来の業績を約束するものではありません。</li>
                        <li>実際の売上・利益は、市場環境、競合状況、経営努力、地域特性等により変動します。</li>
                        <li>機器購入や加盟契約の判断は、本シミュレーションのみに依拠せず、十分な検討の上で行ってください。</li>
                        <li>本シミュレーションの利用により生じた損害について、当社は一切の責任を負いません。</li>
                    </ol>
                </div>
            </div>

            <!-- シナリオ比較タブ -->
            <div class="tab-pane fade" id="comparison" role="tabpanel" aria-labelledby="comparison-tab">
                <div class="text-center mt-2 mb-4">
                    <h4 id="comparisonCompanyName" class="text-primary">【 株式会社シムラ 様 専用シミュレーション 】</h4>
                    <h3><i class="fas fa-balance-scale"></i> 3シナリオ比較分析</h3>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-dark text-white">
                                <h5>重要指標の比較</h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered comparison-table">
                                    <thead>
                                        <tr>
                                            <th>指標</th>
                                            <th class="scenario-optimistic"><i class="fas fa-smile"></i> 楽観的シナリオ</th>
                                            <th class="scenario-realistic"><i class="fas fa-chart-line"></i> 現実的シナリオ</th>
                                            <th class="scenario-pessimistic"><i class="fas fa-frown"></i> 悲観的シナリオ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>投資回収月</strong></td>
                                            <td class="scenario-optimistic" id="comp_recovery_optimistic">12ヶ月目</td>
                                            <td class="scenario-realistic" id="comp_recovery_realistic">11ヶ月目</td>
                                            <td class="scenario-pessimistic" id="comp_recovery_pessimistic">22ヶ月目</td>
                                        </tr>
                                        <tr>
                                            <td><strong>2年累積利益</strong></td>
                                            <td class="scenario-optimistic" id="comp_total_optimistic">¥10,060,000</td>
                                            <td class="scenario-realistic" id="comp_total_realistic">¥7,540,000</td>
                                            <td class="scenario-pessimistic" id="comp_total_pessimistic">¥4,340,000</td>
                                        </tr>
                                        <tr>
                                            <td><strong>2年純利益</strong></td>
                                            <td class="scenario-optimistic" id="comp_net_optimistic">¥7,060,000</td>
                                            <td class="scenario-realistic" id="comp_net_realistic">¥4,540,000</td>
                                            <td class="scenario-pessimistic" id="comp_net_pessimistic">¥1,340,000</td>
                                        </tr>
                                        <tr>
                                            <td><strong>投資回収率（ROI）</strong></td>
                                            <td class="scenario-optimistic" id="comp_roi_optimistic">235%</td>
                                            <td class="scenario-realistic" id="comp_roi_realistic">151%</td>
                                            <td class="scenario-pessimistic" id="comp_roi_pessimistic">45%</td>
                                        </tr>
                                        <tr>
                                            <td><strong>2年間総売上</strong></td>
                                            <td class="scenario-optimistic" id="comp_sales_optimistic">¥10,540,000</td>
                                            <td class="scenario-realistic" id="comp_sales_realistic">¥8,020,000</td>
                                            <td class="scenario-pessimistic" id="comp_sales_pessimistic">¥4,820,000</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6>累積利益の比較（24ヶ月）</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="height: 400px;">
                                    <canvas id="comparisonProfitChart" style="box-sizing: border-box; display: block; height: 0px; width: 0px;" width="0" height="0"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6>月次売上の比較（24ヶ月）</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="height: 400px;">
                                    <canvas id="comparisonSalesChart" style="box-sizing: border-box; display: block; height: 0px; width: 0px;" width="0" height="0"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 免責事項 -->
                <div class="disclaimer-box mt-4">
                    <h6 class="disclaimer-title"><i class="fas fa-exclamation-triangle"></i> 免責事項</h6>
                    <ol class="disclaimer-list">
                        <li>本シミュレーションは情報提供を目的としており、実際の収益を保証するものではありません。</li>
                        <li>記載された数値は一定の前提条件に基づく予測値であり、将来の業績を約束するものではありません。</li>
                        <li>実際の売上・利益は、市場環境、競合状況、経営努力、地域特性等により変動します。</li>
                        <li>機器購入や加盟契約の判断は、本シミュレーションのみに依拠せず、十分な検討の上で行ってください。</li>
                        <li>本シミュレーションの利用により生じた損害について、当社は一切の責任を負いません。</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // シナリオデータ
        const scenarioData = {
            realistic: [
                [0,0,0,0,0], [0,0,0,0,0], [1,0,0,0,0], [1,0,0,0,0], [1,0,0,0,0], [2,0,0,0,0],
                [2,0,0,0,0], [3,0,0,0,0], [3,0,0,0,0], [4,0,0,0,0], [4,0,0,0,0], [5,0,0,0,0],
                [5,1,0,0,2], [6,0,1,0,2], [6,0,0,1,2], [7,1,0,0,2], [7,0,1,0,2], [8,1,0,0,3],
                [8,0,1,0,3], [8,1,0,0,3], [8,0,0,0,4], [8,0,0,0,4], [8,0,0,0,5], [8,0,0,0,5]
            ],
            optimistic: [
                [1,0,0,0,1], [2,1,0,0,2], [3,1,0,0,3], [4,1,0,0,4], [5,2,0,0,4], [5,2,1,0,5],
                [6,2,0,0,5], [6,3,0,0,5], [7,3,1,0,6], [7,3,0,1,6], [8,3,0,0,6], [8,4,1,0,6],
                [8,4,0,0,7], [9,4,1,0,7], [9,4,0,0,7], [10,4,0,0,7], [10,5,1,1,8], [10,5,0,0,8],
                [11,5,0,0,8], [11,5,1,0,8], [12,5,0,0,9], [12,5,0,1,9], [12,6,1,0,9], [13,6,0,0,10]
            ],
            pessimistic: [
                [0,0,0,0,0], [0,0,0,0,0], [0,0,0,0,1], [1,0,0,0,1], [1,0,0,0,2], [1,1,0,0,2],
                [2,1,0,0,2], [2,1,0,0,2], [2,1,0,0,3], [3,1,0,0,3], [3,1,0,0,3], [3,1,1,0,3],
                [4,2,0,0,3], [4,2,0,0,3], [4,2,0,0,4], [4,2,0,0,4], [5,2,0,0,4], [5,2,0,1,4],
                [5,2,1,0,4], [5,2,0,0,5], [6,2,0,0,5], [6,3,0,0,5], [6,3,0,1,5], [6,3,1,0,5]
            ]
        };

        let currentScenario = 'realistic';
        let charts = {};

        // 数値フォーマット
        function formatNumber(num) {
            return new Intl.NumberFormat('ja-JP').format(num);
        }

        // 企業名更新
        function updateCompanyName() {
            let companyName = document.getElementById('companyName').value.trim();
            
            // 既に「様」が付いている場合は削除
            if (companyName.endsWith('様')) {
                companyName = companyName.slice(0, -1).trim();
            }
            
            const displayText = companyName ? `【 ${companyName} 様 専用シミュレーション 】` : '';
            document.getElementById('settingsCompanyName').textContent = displayText;
            document.getElementById('editSimulationCompanyName').textContent = displayText;
            document.getElementById('simulationCompanyName').textContent = displayText;
            document.getElementById('summaryCompanyName').textContent = displayText;
            document.getElementById('comparisonCompanyName').textContent = displayText;
            saveToLocalStorage();
        }
        
        // シナリオ名表示切り替え
        function toggleScenarioName() {
            const toggle = document.getElementById('showScenarioNameToggle');
            const status = document.getElementById('toggleStatus');
            const scenarioPrintHeader = document.getElementById('summaryScenarioPrint');
            
            if (toggle.checked) {
                // 表示状態
                status.textContent = '表示';
                status.style.color = '#4caf50';
                if (scenarioPrintHeader) {
                    scenarioPrintHeader.style.opacity = '1';
                }
            } else {
                // 非表示状態
                status.textContent = '非表示';
                status.style.color = '#f44336';
                if (scenarioPrintHeader) {
                    scenarioPrintHeader.style.opacity = '0.3';
                }
            }
            
            // LocalStorageに保存
            localStorage.setItem('showScenarioName', toggle.checked);
        }
        
        // シナリオ名表示設定の読み込み
        function loadScenarioNameSetting() {
            const saved = localStorage.getItem('showScenarioName');
            const toggle = document.getElementById('showScenarioNameToggle');
            
            if (saved !== null) {
                toggle.checked = (saved === 'true');
                toggleScenarioName();
            }
        }

        // シナリオ切り替え
        function switchScenario(scenario) {
            currentScenario = scenario;
            
            // ボタンのアクティブ状態更新
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.scenario-btn').classList.add('active');
            
            // 現実的シナリオの警告メッセージ表示切り替え
            const alert = document.getElementById('realisticReadonlyAlert');
            if (alert) {
                alert.style.display = (scenario === 'realistic') ? 'block' : 'none';
            }
            
            // ラベル更新
            const labels = {
                'realistic': '現実的',
                'optimistic': '楽観的',
                'pessimistic': '悲観的'
            };
            
            const labelsFull = {
                'realistic': '現実的シナリオ',
                'optimistic': '楽観的シナリオ',
                'pessimistic': '悲観的シナリオ'
            };
            
            // 画面表示用（大きな文字）
            document.getElementById('simulationScenarioName').textContent = labels[scenario];
            document.getElementById('summaryScenarioName').textContent = labels[scenario];
            
            // 印刷用ヘッダー
            document.getElementById('simulationScenarioPrint').textContent = `【 ${labelsFull[scenario]} 】`;
            document.getElementById('summaryScenarioPrint').textContent = `【 ${labelsFull[scenario]} 】`;
            
            calculate();
        }

        // 設定値取得
        function getSettings() {
            return {
                initialFee: parseInt(document.getElementById('initialFee').value.replace(/¥|,/g, '')) || 0,
                equipmentFee: parseInt(document.getElementById('equipmentFee').value.replace(/¥|,/g, '')) || 0,
                cloudFee: parseInt(document.getElementById('cloudFee').value.replace(/¥|,/g, '')) || 0,
                geoWebFee: parseInt(document.getElementById('geoWebFee').value.replace(/¥|,/g, '')) || 0,
                appFee: parseInt(document.getElementById('appFee').value.replace(/¥|,/g, '')) || 0,
                survey3dPrice: parseInt(document.getElementById('survey3dPrice').value.replace(/¥|,/g, '')) || 0,
                survey3dCost: parseInt(document.getElementById('survey3dCost').value.replace(/¥|,/g, '')) || 0,
                vrSmallPrice: parseInt(document.getElementById('vrSmallPrice').value.replace(/¥|,/g, '')) || 0,
                vrMediumPrice: parseInt(document.getElementById('vrMediumPrice').value.replace(/¥|,/g, '')) || 0,
                vrLargePrice: parseInt(document.getElementById('vrLargePrice').value.replace(/¥|,/g, '')) || 0,
                headquarterPrice: parseInt(document.getElementById('headquarterPrice').value.replace(/¥|,/g, '')) || 0
            };
        }

        // 月次データ更新（編集用）
        function updateEditMonthlyData(monthIndex, dataIndex, value) {
            scenarioData['realistic'][monthIndex][dataIndex] = parseInt(value) || 0;
            calculate();
            calculateEditSimulation();
        }
        
        // 月次データ更新（閲覧用 - 現実的以外のみ編集可能）
        function updateMonthlyData(monthIndex, dataIndex, value) {
            if (currentScenario !== 'realistic') {
                scenarioData[currentScenario][monthIndex][dataIndex] = parseInt(value) || 0;
                calculate();
            }
        }

        // 計算実行
        function calculate() {
            const settings = getSettings();
            
            // 合計計算
            document.getElementById('totalInitialInvestment').value = '¥' + formatNumber(settings.initialFee + settings.equipmentFee);
            document.getElementById('totalMonthlyFixedCost').value = '¥' + formatNumber(settings.cloudFee + settings.geoWebFee + settings.appFee);
            
            const totalInitialInvestment = settings.initialFee + settings.equipmentFee;
            const monthlyFixedCost = settings.cloudFee + settings.geoWebFee + settings.appFee;
            
            let cumulativeProfit = 0;
            let recoveryMonth = 0;
            
            // テーブル更新
            const tbody = document.getElementById('simulationTableBody');
            tbody.innerHTML = '';
            
            const monthlyData = scenarioData[currentScenario];
            
            // 1年目と2年目の集計用変数
            let year1_survey3dCount = 0, year1_vrSmallCount = 0, year1_vrMediumCount = 0, year1_vrLargeCount = 0, year1_headquarterCount = 0;
            let year1_survey3dSales = 0, year1_vrSmallSales = 0, year1_vrMediumSales = 0, year1_vrLargeSales = 0, year1_headquarterSales = 0;
            let year1_totalSales = 0, year1_fixedCost = 0, year1_survey3dCost = 0, year1_profit = 0;
            
            let year2_survey3dCount = 0, year2_vrSmallCount = 0, year2_vrMediumCount = 0, year2_vrLargeCount = 0, year2_headquarterCount = 0;
            let year2_survey3dSales = 0, year2_vrSmallSales = 0, year2_vrMediumSales = 0, year2_vrLargeSales = 0, year2_headquarterSales = 0;
            let year2_totalSales = 0, year2_fixedCost = 0, year2_survey3dCost = 0, year2_profit = 0;
            
            for (let i = 0; i < 24; i++) {
                const month = i + 1;
                const data = monthlyData[i];
                
                const survey3dSales = data[0] * settings.survey3dPrice;
                const vrSmallSales = data[1] * settings.vrSmallPrice;
                const vrMediumSales = data[2] * settings.vrMediumPrice;
                const vrLargeSales = data[3] * settings.vrLargePrice;
                const headquarterSales = data[4] * settings.headquarterPrice;
                const totalSales = survey3dSales + vrSmallSales + vrMediumSales + vrLargeSales + headquarterSales;
                
                const survey3dCostTotal = data[0] * settings.survey3dCost;
                const monthlyProfit = totalSales - monthlyFixedCost - survey3dCostTotal;
                cumulativeProfit += monthlyProfit;
                
                // 年次集計
                if (i < 12) {
                    year1_survey3dCount += data[0];
                    year1_vrSmallCount += data[1];
                    year1_vrMediumCount += data[2];
                    year1_vrLargeCount += data[3];
                    year1_headquarterCount += data[4];
                    year1_survey3dSales += survey3dSales;
                    year1_vrSmallSales += vrSmallSales;
                    year1_vrMediumSales += vrMediumSales;
                    year1_vrLargeSales += vrLargeSales;
                    year1_headquarterSales += headquarterSales;
                    year1_totalSales += totalSales;
                    year1_fixedCost += monthlyFixedCost;
                    year1_survey3dCost += survey3dCostTotal;
                    year1_profit += monthlyProfit;
                } else {
                    year2_survey3dCount += data[0];
                    year2_vrSmallCount += data[1];
                    year2_vrMediumCount += data[2];
                    year2_vrLargeCount += data[3];
                    year2_headquarterCount += data[4];
                    year2_survey3dSales += survey3dSales;
                    year2_vrSmallSales += vrSmallSales;
                    year2_vrMediumSales += vrMediumSales;
                    year2_vrLargeSales += vrLargeSales;
                    year2_headquarterSales += headquarterSales;
                    year2_totalSales += totalSales;
                    year2_fixedCost += monthlyFixedCost;
                    year2_survey3dCost += survey3dCostTotal;
                    year2_profit += monthlyProfit;
                }
                
                const isRecoveryMonth = (recoveryMonth === 0 && cumulativeProfit >= totalInitialInvestment);
                if (isRecoveryMonth) {
                    recoveryMonth = month;
                }
                
                const row = document.createElement('tr');
                
                // 大規模案件の月を薄緑に
                let rowClass = '';
                if (data[3] > 0) rowClass = 'large-project-month';
                row.className = rowClass;
                
                // 現実的シナリオの場合は読み取り専用
                const isReadOnly = currentScenario === 'realistic';
                const readOnlyAttr = isReadOnly ? ' readonly style="background-color: #f8f9fa; cursor: not-allowed;"' : '';
                
                row.innerHTML = `
                    <td>${month}ヶ月目</td>
                    <td><input type="number" value="${data[0]}" class="editable" onchange="updateMonthlyData(${i}, 0, this.value)"${readOnlyAttr}></td>
                    <td><input type="number" value="${data[1]}" class="editable" onchange="updateMonthlyData(${i}, 1, this.value)"${readOnlyAttr}></td>
                    <td><input type="number" value="${data[2]}" class="editable" onchange="updateMonthlyData(${i}, 2, this.value)"${readOnlyAttr}></td>
                    <td><input type="number" value="${data[3]}" class="editable" onchange="updateMonthlyData(${i}, 3, this.value)"${readOnlyAttr}></td>
                    <td><input type="number" value="${data[4]}" class="editable" onchange="updateMonthlyData(${i}, 4, this.value)"${readOnlyAttr}></td>
                    <td class="calculated">¥${formatNumber(survey3dSales)}</td>
                    <td class="calculated">¥${formatNumber(vrSmallSales)}</td>
                    <td class="calculated">¥${formatNumber(vrMediumSales)}</td>
                    <td class="calculated">¥${formatNumber(vrLargeSales)}</td>
                    <td class="calculated">¥${formatNumber(headquarterSales)}</td>
                    <td class="calculated"><strong>¥${formatNumber(totalSales)}</strong></td>
                    <td class="calculated expense-cell">-¥${formatNumber(monthlyFixedCost)}</td>
                    <td class="calculated expense-cell">-¥${formatNumber(survey3dCostTotal)}</td>
                    <td class="calculated ${monthlyProfit < 0 ? 'negative' : 'positive'}">¥${formatNumber(monthlyProfit)}</td>
                    <td class="calculated ${cumulativeProfit < 0 ? 'negative' : 'positive'} ${isRecoveryMonth ? 'recovery-cell' : ''}">¥${formatNumber(cumulativeProfit)}</td>
                `;
                
                tbody.appendChild(row);
                
                // 12ヶ月目の後に1年目合計行を追加
                if (month === 12) {
                    const year1CumulativeProfit = cumulativeProfit;
                    const summaryRow = document.createElement('tr');
                    summaryRow.className = 'summary-row';
                    summaryRow.innerHTML = `
                        <td><strong>1年目合計</strong></td>
                        <td><strong>${year1_survey3dCount}</strong></td>
                        <td><strong>${year1_vrSmallCount}</strong></td>
                        <td><strong>${year1_vrMediumCount}</strong></td>
                        <td><strong>${year1_vrLargeCount}</strong></td>
                        <td><strong>${year1_headquarterCount}</strong></td>
                        <td><strong>¥${formatNumber(year1_survey3dSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_vrSmallSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_vrMediumSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_vrLargeSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_headquarterSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_totalSales)}</strong></td>
                        <td><strong>-¥${formatNumber(year1_fixedCost)}</strong></td>
                        <td><strong>-¥${formatNumber(year1_survey3dCost)}</strong></td>
                        <td><strong>¥${formatNumber(year1_profit)}</strong></td>
                        <td><strong>¥${formatNumber(year1CumulativeProfit)}</strong></td>
                    `;
                    tbody.appendChild(summaryRow);
                }
            }
            
            // 24ヶ月目の後に2年目合計行を追加
            const year2CumulativeProfit = cumulativeProfit;
            const summaryRow2 = document.createElement('tr');
            summaryRow2.className = 'summary-row';
            summaryRow2.innerHTML = `
                <td><strong>2年目合計</strong></td>
                <td><strong>${year2_survey3dCount}</strong></td>
                <td><strong>${year2_vrSmallCount}</strong></td>
                <td><strong>${year2_vrMediumCount}</strong></td>
                <td><strong>${year2_vrLargeCount}</strong></td>
                <td><strong>${year2_headquarterCount}</strong></td>
                <td><strong>¥${formatNumber(year2_survey3dSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_vrSmallSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_vrMediumSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_vrLargeSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_headquarterSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_totalSales)}</strong></td>
                <td><strong>-¥${formatNumber(year2_fixedCost)}</strong></td>
                <td><strong>-¥${formatNumber(year2_survey3dCost)}</strong></td>
                <td><strong>¥${formatNumber(year2_profit)}</strong></td>
                <td><strong>¥${formatNumber(year2CumulativeProfit)}</strong></td>
            `;
            tbody.appendChild(summaryRow2);
            
            updateSummary();
            updateCharts();
            updateComparison();
            saveToLocalStorage();
        }

        // サマリー更新
        function updateSummary() {
            const settings = getSettings();
            const totalInitialInvestment = settings.initialFee + settings.equipmentFee;
            const monthlyFixedCost = settings.cloudFee + settings.geoWebFee + settings.appFee;
            
            let cumulativeProfit = 0;
            let recoveryMonth = 0;
            let recoveryProfit = 0;
            let year1Sales = 0, year2Sales = 0;
            let year1Profit = 0, year2Profit = 0;
            let year1Cumulative = 0, year2Cumulative = 0;
            let totals = [0, 0, 0, 0, 0];
            
            const monthlyData = scenarioData[currentScenario];
            
            for (let i = 0; i < 24; i++) {
                const data = monthlyData[i];
                const totalSales = data[0] * settings.survey3dPrice + 
                                 data[1] * settings.vrSmallPrice + 
                                 data[2] * settings.vrMediumPrice + 
                                 data[3] * settings.vrLargePrice + 
                                 data[4] * settings.headquarterPrice;
                const survey3dCostTotal = data[0] * settings.survey3dCost;
                const monthlyProfit = totalSales - monthlyFixedCost - survey3dCostTotal;
                cumulativeProfit += monthlyProfit;
                
                if (recoveryMonth === 0 && cumulativeProfit >= totalInitialInvestment) {
                    recoveryMonth = i + 1;
                    recoveryProfit = cumulativeProfit - totalInitialInvestment;
                }
                
                if (i < 12) {
                    year1Sales += totalSales;
                    year1Profit += monthlyProfit;
                    year1Cumulative = cumulativeProfit;
                } else {
                    year2Sales += totalSales;
                    year2Profit += monthlyProfit;
                }
                
                for (let j = 0; j < 5; j++) {
                    totals[j] += data[j];
                }
            }
            
            year2Cumulative = cumulativeProfit;
            const netProfit = year2Cumulative - totalInitialInvestment;
            const roi = totalInitialInvestment > 0 ? (netProfit / totalInitialInvestment * 100) : 0;
            
            // サマリー表示更新
            document.getElementById('summaryInitialInvestment').textContent = `¥${formatNumber(totalInitialInvestment)}`;
            document.getElementById('summaryRecoveryMonth').textContent = recoveryMonth > 0 ? `${recoveryMonth}ヶ月目` : '未回収';
            document.getElementById('summaryRecoveryProfit').textContent = `¥${formatNumber(recoveryProfit)}`;
            document.getElementById('summaryTotalProfit').textContent = `¥${formatNumber(year2Cumulative)}`;
            document.getElementById('summaryNetProfit').textContent = `¥${formatNumber(netProfit)}`;
            document.getElementById('summaryROI').textContent = `${Math.round(roi)}%`;
            
            document.getElementById('year1Sales').textContent = `¥${formatNumber(year1Sales)}`;
            document.getElementById('year1FixedCost').textContent = `¥${formatNumber(monthlyFixedCost * 12)}`;
            document.getElementById('year1Profit').textContent = `¥${formatNumber(year1Profit)}`;
            document.getElementById('year1Cumulative').textContent = `¥${formatNumber(year1Cumulative)}`;
            
            document.getElementById('year2Sales').textContent = `¥${formatNumber(year2Sales)}`;
            document.getElementById('year2FixedCost').textContent = `¥${formatNumber(monthlyFixedCost * 12)}`;
            document.getElementById('year2Profit').textContent = `¥${formatNumber(year2Profit)}`;
            document.getElementById('year2Cumulative').textContent = `¥${formatNumber(year2Cumulative)}`;
            
            document.getElementById('totalSurvey3d').textContent = `${totals[0]}件`;
            document.getElementById('totalVrSmall').textContent = `${totals[1]}件`;
            document.getElementById('totalVrMedium').textContent = `${totals[2]}件`;
            document.getElementById('totalVrLarge').textContent = `${totals[3]}件`;
            document.getElementById('totalHeadquarter').textContent = `${totals[4]}件`;
        }

        // チャート更新
        function updateCharts() {
            const settings = getSettings();
            const monthlyFixedCost = settings.cloudFee + settings.geoWebFee + settings.appFee;
            
            const months = [];
            const salesData = [];
            const cumulativeProfitData = [];
            let cumulativeProfit = 0;
            
            const monthlyData = scenarioData[currentScenario];
            
            for (let i = 0; i < 24; i++) {
                months.push(`${i + 1}ヶ月目`);
                const data = monthlyData[i];
                const totalSales = data[0] * settings.survey3dPrice + 
                                 data[1] * settings.vrSmallPrice + 
                                 data[2] * settings.vrMediumPrice + 
                                 data[3] * settings.vrLargePrice + 
                                 data[4] * settings.headquarterPrice;
                const survey3dCostTotal = data[0] * settings.survey3dCost;
                salesData.push(totalSales);
                cumulativeProfit += (totalSales - monthlyFixedCost - survey3dCostTotal);
                cumulativeProfitData.push(cumulativeProfit);
            }
            
            // 売上推移チャート
            if (charts.sales) charts.sales.destroy();
            charts.sales = new Chart(document.getElementById('salesChart'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: '月次売上',
                        data: salesData,
                        backgroundColor: 'rgba(54, 162, 235, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¥' + formatNumber(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '売上: ¥' + formatNumber(context.raw);
                                }
                            }
                        }
                    }
                }
            });
            
            // 累積利益チャート
            if (charts.profit) charts.profit.destroy();
            charts.profit = new Chart(document.getElementById('profitChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '累積利益',
                            data: cumulativeProfitData,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: false,
                            tension: 0.1
                        },
                        {
                            label: '投資回収ライン',
                            data: new Array(24).fill(settings.initialFee + settings.equipmentFee),
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '¥' + formatNumber(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ¥' + formatNumber(context.raw);
                                }
                            }
                        }
                    }
                }
            });
            
            // サービス別構成円グラフ
            const totalSales = {
                survey3d: 0,
                vrSmall: 0,
                vrMedium: 0,
                vrLarge: 0,
                headquarter: 0
            };
            
            for (let i = 0; i < 24; i++) {
                const data = monthlyData[i];
                totalSales.survey3d += data[0] * settings.survey3dPrice;
                totalSales.vrSmall += data[1] * settings.vrSmallPrice;
                totalSales.vrMedium += data[2] * settings.vrMediumPrice;
                totalSales.vrLarge += data[3] * settings.vrLargePrice;
                totalSales.headquarter += data[4] * settings.headquarterPrice;
            }
            
            if (charts.pie) charts.pie.destroy();
            charts.pie = new Chart(document.getElementById('pieChart'), {
                type: 'pie',
                data: {
                    labels: ['3D測量', 'VR小規模', 'VR中規模', 'VR大規模', '本部案件'],
                    datasets: [{
                        data: [
                            totalSales.survey3d,
                            totalSales.vrSmall,
                            totalSales.vrMedium,
                            totalSales.vrLarge,
                            totalSales.headquarter
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 18,
                                font: {
                                    size: 12
                                },
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return context.label + ': ¥' + formatNumber(context.raw) + ' (' + percentage + '%)';
                                }
                            }
                        }
                    },
                    layout: {
                        padding: {
                            top: 5,
                            bottom: 5,
                            left: 5,
                            right: 5
                        }
                    }
                }
            });
        }

        // シナリオ比較更新
        function updateComparison() {
            const settings = getSettings();
            const totalInitialInvestment = settings.initialFee + settings.equipmentFee;
            const monthlyFixedCost = settings.cloudFee + settings.geoWebFee + settings.appFee;
            
            const comparisonResults = {};
            const months = [];
            
            for (let i = 1; i <= 24; i++) {
                months.push(`${i}ヶ月`);
            }
            
            // 各シナリオの計算
            ['optimistic', 'realistic', 'pessimistic'].forEach(scenario => {
                let cumulativeProfit = 0;
                let totalSales = 0;
                let recoveryMonth = 0;
                const profitData = [];
                const salesData = [];
                
                for (let i = 0; i < 24; i++) {
                    const data = scenarioData[scenario][i];
                    const monthlySales = data[0] * settings.survey3dPrice + 
                                       data[1] * settings.vrSmallPrice + 
                                       data[2] * settings.vrMediumPrice + 
                                       data[3] * settings.vrLargePrice + 
                                       data[4] * settings.headquarterPrice;
                    const survey3dCostTotal = data[0] * settings.survey3dCost;
                    const monthlyProfit = monthlySales - monthlyFixedCost - survey3dCostTotal;
                    cumulativeProfit += monthlyProfit;
                    totalSales += monthlySales;
                    
                    if (recoveryMonth === 0 && cumulativeProfit >= totalInitialInvestment) {
                        recoveryMonth = i + 1;
                    }
                    
                    profitData.push(cumulativeProfit);
                    salesData.push(monthlySales);
                }
                
                const netProfit = cumulativeProfit - totalInitialInvestment;
                const roi = totalInitialInvestment > 0 ? (netProfit / totalInitialInvestment * 100) : 0;
                
                comparisonResults[scenario] = {
                    recoveryMonth: recoveryMonth > 0 ? `${recoveryMonth}ヶ月目` : '未回収',
                    totalProfit: cumulativeProfit,
                    netProfit: netProfit,
                    roi: Math.round(roi),
                    totalSales: totalSales,
                    profitData: profitData,
                    salesData: salesData
                };
            });
            
            // テーブル更新
            document.getElementById('comp_recovery_optimistic').textContent = comparisonResults.optimistic.recoveryMonth;
            document.getElementById('comp_recovery_realistic').textContent = comparisonResults.realistic.recoveryMonth;
            document.getElementById('comp_recovery_pessimistic').textContent = comparisonResults.pessimistic.recoveryMonth;
            
            document.getElementById('comp_total_optimistic').textContent = `¥${formatNumber(comparisonResults.optimistic.totalProfit)}`;
            document.getElementById('comp_total_realistic').textContent = `¥${formatNumber(comparisonResults.realistic.totalProfit)}`;
            document.getElementById('comp_total_pessimistic').textContent = `¥${formatNumber(comparisonResults.pessimistic.totalProfit)}`;
            
            document.getElementById('comp_net_optimistic').textContent = `¥${formatNumber(comparisonResults.optimistic.netProfit)}`;
            document.getElementById('comp_net_realistic').textContent = `¥${formatNumber(comparisonResults.realistic.netProfit)}`;
            document.getElementById('comp_net_pessimistic').textContent = `¥${formatNumber(comparisonResults.pessimistic.netProfit)}`;
            
            document.getElementById('comp_roi_optimistic').textContent = `${comparisonResults.optimistic.roi}%`;
            document.getElementById('comp_roi_realistic').textContent = `${comparisonResults.realistic.roi}%`;
            document.getElementById('comp_roi_pessimistic').textContent = `${comparisonResults.pessimistic.roi}%`;
            
            document.getElementById('comp_sales_optimistic').textContent = `¥${formatNumber(comparisonResults.optimistic.totalSales)}`;
            document.getElementById('comp_sales_realistic').textContent = `¥${formatNumber(comparisonResults.realistic.totalSales)}`;
            document.getElementById('comp_sales_pessimistic').textContent = `¥${formatNumber(comparisonResults.pessimistic.totalSales)}`;
            
            // 累積利益比較チャート
            if (charts.comparisonProfit) charts.comparisonProfit.destroy();
            charts.comparisonProfit = new Chart(document.getElementById('comparisonProfitChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '楽観的',
                            data: comparisonResults.optimistic.profitData,
                            borderColor: 'rgba(40, 167, 69, 1)',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: '現実的',
                            data: comparisonResults.realistic.profitData,
                            borderColor: 'rgba(255, 193, 7, 1)',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: '悲観的',
                            data: comparisonResults.pessimistic.profitData,
                            borderColor: 'rgba(220, 53, 69, 1)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: '投資回収ライン',
                            data: new Array(24).fill(totalInitialInvestment),
                            borderColor: 'rgba(108, 117, 125, 0.5)',
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '¥' + formatNumber(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ¥' + formatNumber(context.raw);
                                }
                            }
                        }
                    }
                }
            });
            
            // 月次売上比較チャート
            if (charts.comparisonSales) charts.comparisonSales.destroy();
            charts.comparisonSales = new Chart(document.getElementById('comparisonSalesChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: '楽観的',
                            data: comparisonResults.optimistic.salesData,
                            borderColor: 'rgba(40, 167, 69, 1)',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: '現実的',
                            data: comparisonResults.realistic.salesData,
                            borderColor: 'rgba(255, 193, 7, 1)',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            tension: 0.1
                        },
                        {
                            label: '悲観的',
                            data: comparisonResults.pessimistic.salesData,
                            borderColor: 'rgba(220, 53, 69, 1)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¥' + formatNumber(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ¥' + formatNumber(context.raw);
                                }
                            }
                        }
                    }
                }
            });
        }

        // 編集シミュレーション計算
        function calculateEditSimulation() {
            const settings = getSettings();
            const totalInitialInvestment = settings.initialFee + settings.equipmentFee;
            const monthlyFixedCost = settings.cloudFee + settings.geoWebFee + settings.appFee;
            
            let cumulativeProfit = 0;
            let recoveryMonth = 0;
            
            // テーブル更新
            const tbody = document.getElementById('editSimulationTableBody');
            tbody.innerHTML = '';
            
            const monthlyData = scenarioData['realistic'];
            
            // 1年目と2年目の集計用変数
            let year1_survey3dCount = 0, year1_vrSmallCount = 0, year1_vrMediumCount = 0, year1_vrLargeCount = 0, year1_headquarterCount = 0;
            let year1_survey3dSales = 0, year1_vrSmallSales = 0, year1_vrMediumSales = 0, year1_vrLargeSales = 0, year1_headquarterSales = 0;
            let year1_totalSales = 0, year1_fixedCost = 0, year1_survey3dCost = 0, year1_profit = 0;
            
            let year2_survey3dCount = 0, year2_vrSmallCount = 0, year2_vrMediumCount = 0, year2_vrLargeCount = 0, year2_headquarterCount = 0;
            let year2_survey3dSales = 0, year2_vrSmallSales = 0, year2_vrMediumSales = 0, year2_vrLargeSales = 0, year2_headquarterSales = 0;
            let year2_totalSales = 0, year2_fixedCost = 0, year2_survey3dCost = 0, year2_profit = 0;
            
            for (let i = 0; i < 24; i++) {
                const month = i + 1;
                const data = monthlyData[i];
                
                const survey3dSales = data[0] * settings.survey3dPrice;
                const vrSmallSales = data[1] * settings.vrSmallPrice;
                const vrMediumSales = data[2] * settings.vrMediumPrice;
                const vrLargeSales = data[3] * settings.vrLargePrice;
                const headquarterSales = data[4] * settings.headquarterPrice;
                const totalSales = survey3dSales + vrSmallSales + vrMediumSales + vrLargeSales + headquarterSales;
                
                const survey3dCostTotal = data[0] * settings.survey3dCost;
                const monthlyProfit = totalSales - monthlyFixedCost - survey3dCostTotal;
                cumulativeProfit += monthlyProfit;
                
                // 年次集計
                if (i < 12) {
                    year1_survey3dCount += data[0];
                    year1_vrSmallCount += data[1];
                    year1_vrMediumCount += data[2];
                    year1_vrLargeCount += data[3];
                    year1_headquarterCount += data[4];
                    year1_survey3dSales += survey3dSales;
                    year1_vrSmallSales += vrSmallSales;
                    year1_vrMediumSales += vrMediumSales;
                    year1_vrLargeSales += vrLargeSales;
                    year1_headquarterSales += headquarterSales;
                    year1_totalSales += totalSales;
                    year1_fixedCost += monthlyFixedCost;
                    year1_survey3dCost += survey3dCostTotal;
                    year1_profit += monthlyProfit;
                } else {
                    year2_survey3dCount += data[0];
                    year2_vrSmallCount += data[1];
                    year2_vrMediumCount += data[2];
                    year2_vrLargeCount += data[3];
                    year2_headquarterCount += data[4];
                    year2_survey3dSales += survey3dSales;
                    year2_vrSmallSales += vrSmallSales;
                    year2_vrMediumSales += vrMediumSales;
                    year2_vrLargeSales += vrLargeSales;
                    year2_headquarterSales += headquarterSales;
                    year2_totalSales += totalSales;
                    year2_fixedCost += monthlyFixedCost;
                    year2_survey3dCost += survey3dCostTotal;
                    year2_profit += monthlyProfit;
                }
                
                const isRecoveryMonth = (recoveryMonth === 0 && cumulativeProfit >= totalInitialInvestment);
                if (isRecoveryMonth) {
                    recoveryMonth = month;
                }
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${month}ヶ月目</td>
                    <td><input type="number" value="${data[0]}" class="editable" onchange="updateEditMonthlyData(${i}, 0, this.value)"></td>
                    <td><input type="number" value="${data[1]}" class="editable" onchange="updateEditMonthlyData(${i}, 1, this.value)"></td>
                    <td><input type="number" value="${data[2]}" class="editable" onchange="updateEditMonthlyData(${i}, 2, this.value)"></td>
                    <td><input type="number" value="${data[3]}" class="editable" onchange="updateEditMonthlyData(${i}, 3, this.value)"></td>
                    <td><input type="number" value="${data[4]}" class="editable" onchange="updateEditMonthlyData(${i}, 4, this.value)"></td>
                    <td class="calculated">¥${formatNumber(survey3dSales)}</td>
                    <td class="calculated">¥${formatNumber(vrSmallSales)}</td>
                    <td class="calculated">¥${formatNumber(vrMediumSales)}</td>
                    <td class="calculated">¥${formatNumber(vrLargeSales)}</td>
                    <td class="calculated">¥${formatNumber(headquarterSales)}</td>
                    <td class="calculated"><strong>¥${formatNumber(totalSales)}</strong></td>
                    <td class="calculated expense-cell">-¥${formatNumber(monthlyFixedCost)}</td>
                    <td class="calculated expense-cell">-¥${formatNumber(survey3dCostTotal)}</td>
                    <td class="calculated ${monthlyProfit < 0 ? 'negative' : 'positive'}">¥${formatNumber(monthlyProfit)}</td>
                    <td class="calculated ${cumulativeProfit < 0 ? 'negative' : (isRecoveryMonth ? 'recovery-cell' : 'positive')}">¥${formatNumber(cumulativeProfit)}</td>
                `;
                
                tbody.appendChild(row);
                
                // 12ヶ月目の後に1年目合計行を追加
                if (month === 12) {
                    const year1CumulativeProfit = cumulativeProfit;
                    const summaryRow = document.createElement('tr');
                    summaryRow.className = 'summary-row';
                    summaryRow.innerHTML = `
                        <td><strong>1年目合計</strong></td>
                        <td><strong>${year1_survey3dCount}</strong></td>
                        <td><strong>${year1_vrSmallCount}</strong></td>
                        <td><strong>${year1_vrMediumCount}</strong></td>
                        <td><strong>${year1_vrLargeCount}</strong></td>
                        <td><strong>${year1_headquarterCount}</strong></td>
                        <td><strong>¥${formatNumber(year1_survey3dSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_vrSmallSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_vrMediumSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_vrLargeSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_headquarterSales)}</strong></td>
                        <td><strong>¥${formatNumber(year1_totalSales)}</strong></td>
                        <td><strong>-¥${formatNumber(year1_fixedCost)}</strong></td>
                        <td><strong>-¥${formatNumber(year1_survey3dCost)}</strong></td>
                        <td><strong>¥${formatNumber(year1_profit)}</strong></td>
                        <td><strong>¥${formatNumber(year1CumulativeProfit)}</strong></td>
                    `;
                    tbody.appendChild(summaryRow);
                }
            }
            
            // 24ヶ月目の後に2年目合計行を追加
            const year2CumulativeProfit = cumulativeProfit;
            const summaryRow2 = document.createElement('tr');
            summaryRow2.className = 'summary-row';
            summaryRow2.innerHTML = `
                <td><strong>2年目合計</strong></td>
                <td><strong>${year2_survey3dCount}</strong></td>
                <td><strong>${year2_vrSmallCount}</strong></td>
                <td><strong>${year2_vrMediumCount}</strong></td>
                <td><strong>${year2_vrLargeCount}</strong></td>
                <td><strong>${year2_headquarterCount}</strong></td>
                <td><strong>¥${formatNumber(year2_survey3dSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_vrSmallSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_vrMediumSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_vrLargeSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_headquarterSales)}</strong></td>
                <td><strong>¥${formatNumber(year2_totalSales)}</strong></td>
                <td><strong>-¥${formatNumber(year2_fixedCost)}</strong></td>
                <td><strong>-¥${formatNumber(year2_survey3dCost)}</strong></td>
                <td><strong>¥${formatNumber(year2_profit)}</strong></td>
                <td><strong>¥${formatNumber(year2CumulativeProfit)}</strong></td>
            `;
            tbody.appendChild(summaryRow2);
        }

        // LocalStorage保存
        function saveToLocalStorage() {
            const settings = getSettings();
            const data = {
                settings: settings,
                scenarioData: scenarioData,
                currentScenario: currentScenario,
                companyName: document.getElementById('companyName').value,
                pageTitle: document.getElementById('pageTitle').value
            };
            localStorage.setItem('franchiseSimulation', JSON.stringify(data));
        }
        
        // データエクスポート
        function exportData() {
            const settings = getSettings();
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                companyName: document.getElementById('companyName').value,
                pageTitle: document.getElementById('pageTitle').value,
                settings: settings,
                scenarioData: scenarioData,
                currentScenario: currentScenario
            };
            
            // ファイル名生成
            const companyName = document.getElementById('companyName').value.trim().replace(/様$/, '').trim() || '新規プロジェクト';
            const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
            const filename = `${companyName}_${date}.json`;
            
            // ダウンロード
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // 成功メッセージ
            showMessage('success', `データを保存しました: ${filename}`);
        }
        
        // データインポート
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // バージョンチェック
                    if (!data.version) {
                        if (!confirm('古い形式のデータです。読み込みますか？')) return;
                    }
                    
                    // プレビュー表示
                    const companyName = data.companyName || '不明';
                    const exportDate = data.exportDate ? new Date(data.exportDate).toLocaleString('ja-JP') : '不明';
                    
                    if (!confirm(`以下のデータを読み込みますか？\n\n企業名: ${companyName}\n保存日時: ${exportDate}\n\n※ 現在のデータは上書きされます`)) {
                        event.target.value = ''; // ファイル選択をクリア
                        return;
                    }
                    
                    // データ復元
                    if (data.companyName) {
                        document.getElementById('companyName').value = data.companyName;
                    }
                    
                    if (data.pageTitle) {
                        document.getElementById('pageTitle').value = data.pageTitle;
                    }
                    
                    if (data.settings) {
                        Object.keys(data.settings).forEach(key => {
                            const element = document.getElementById(key);
                            if (element) {
                                element.value = data.settings[key];
                            }
                        });
                    }
                    
                    if (data.scenarioData) {
                        Object.assign(scenarioData, data.scenarioData);
                    }
                    
                    if (data.currentScenario) {
                        currentScenario = data.currentScenario;
                    }
                    
                    // 再計算・表示更新
                    updateCompanyName();
                    updatePageTitle();
                    calculate();
                    
                    // 初期タブに戻る
                    document.getElementById('settings-tab').click();
                    
                    // 成功メッセージ
                    showMessage('success', `データを読み込みました: ${companyName}`);
                    
                    // ファイル選択をクリア
                    event.target.value = '';
                    
                } catch (error) {
                    showMessage('error', 'データの読み込みに失敗しました。ファイルが破損している可能性があります。');
                    console.error('Import error:', error);
                    event.target.value = '';
                }
            };
            reader.readAsText(file);
        }
        
        // メッセージ表示
        function showMessage(type, message) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show`;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '300px';
            alertDiv.innerHTML = `
                <i class="fas ${icon}"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // LocalStorageから復元
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('franchiseSimulation');
            if (saved) {
                const data = JSON.parse(saved);
                
                // 設定復元
                if (data.settings) {
                    Object.keys(data.settings).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = data.settings[key];
                        }
                    });
                }
                
                // シナリオデータ復元
                if (data.scenarioData) {
                    Object.assign(scenarioData, data.scenarioData);
                }
                
                // 現在のシナリオ復元
                if (data.currentScenario) {
                    currentScenario = data.currentScenario;
                }
                
                // 企業名復元
                if (data.companyName) {
                    document.getElementById('companyName').value = data.companyName;
                }
                
                // ページタイトル復元
                if (data.pageTitle) {
                    document.getElementById('pageTitle').value = data.pageTitle;
                }
            }
        }

        // 金額フォーマット（カンマ区切り表示）
        function formatCurrencyInput(input) {
            let value = input.value.replace(/,/g, '');
            if (value && !isNaN(value)) {
                input.value = formatNumber(parseInt(value));
            }
        }
        
        // 金額入力欄のフォーカス時（編集時）
        function onCurrencyFocus(input) {
            input.value = input.value.replace(/,/g, '');
            input.select();
        }
        
        // 金額入力欄のブラー時（編集終了時）
        function onCurrencyBlur(input) {
            formatCurrencyInput(input);
            calculate();
        }
        
        // 初期設定の金額表示を更新
        function updateSettingsDisplay() {
            const currencyFields = [
                'initialFee', 'equipmentFee', 'totalInitialInvestment',
                'cloudFee', 'geoWebFee', 'appFee', 'totalMonthlyFixedCost',
                'survey3dPrice', 'survey3dCost', 'vrSmallPrice', 'vrMediumPrice', 'vrLargePrice', 'headquarterPrice'
            ];
            
            currencyFields.forEach(id => {
                const input = document.getElementById(id);
                if (input && input.value) {
                    const value = parseInt(input.value.toString().replace(/,/g, ''));
                    if (!isNaN(value)) {
                        input.value = '¥' + formatNumber(value);
                    }
                }
            });
        }

        // イベントリスナー設定
        function setupEventListeners() {
            const settingsInputs = ['initialFee', 'equipmentFee', 'cloudFee', 'geoWebFee', 'appFee', 
                                  'survey3dPrice', 'survey3dCost', 'vrSmallPrice', 'vrMediumPrice', 'vrLargePrice', 'headquarterPrice'];
            
            settingsInputs.forEach(id => {
                const input = document.getElementById(id);
                input.addEventListener('focus', function() {
                    this.value = this.value.replace(/¥|,/g, '');
                    this.select();
                });
                input.addEventListener('blur', function() {
                    const value = parseInt(this.value.replace(/,/g, ''));
                    if (!isNaN(value)) {
                        this.value = '¥' + formatNumber(value);
                    }
                    calculate();
                });
            });
            
            document.getElementById('companyName').addEventListener('input', updateCompanyName);
        }

        // タイトル更新
        function updatePageTitle() {
            const title = document.getElementById('pageTitle').value;
            document.getElementById('printTitleText').textContent = title;
            document.title = title;
            saveToLocalStorage();
        }
        

        
        // タブ切り替えエフェクト
        function setupTabEffects() {
            const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
            tabs.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const targetId = e.target.getAttribute('data-bs-target');
                    const targetPane = document.querySelector(targetId);
                    
                    // アニメーションクラスを一度削除して再適用
                    targetPane.classList.remove('show');
                    setTimeout(() => {
                        targetPane.classList.add('show');
                    }, 10);
                });
            });
        }

        // 印刷前処理：フォーカスを外す＆シナリオ名制御
        window.addEventListener('beforeprint', function() {
            // すべてのinput要素からフォーカスを外す
            if (document.activeElement) {
                document.activeElement.blur();
            }
            
            // シナリオ名の表示制御
            const toggle = document.getElementById('showScenarioNameToggle');
            if (toggle && !toggle.checked) {
                document.body.classList.remove('show-scenario-name');
            } else {
                document.body.classList.add('show-scenario-name');
            }
        });
        
        // 印刷後処理：クラスを削除
        window.addEventListener('afterprint', function() {
            document.body.classList.remove('show-scenario-name');
        });

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            setupEventListeners();
            updateCompanyName();
            setupTabEffects();
            loadScenarioNameSetting();
            
            // タイトル編集イベント
            document.getElementById('pageTitle').addEventListener('input', updatePageTitle);
            
            // 初期表示時に金額フォーマットを適用
            setTimeout(function() {
                const currencyFields = [
                    'initialFee', 'equipmentFee', 'cloudFee', 'geoWebFee', 'appFee',
                    'survey3dPrice', 'survey3dCost', 'vrSmallPrice', 'vrMediumPrice', 'vrLargePrice', 'headquarterPrice'
                ];
                
                currencyFields.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        let value = input.value;
                        // 値が空または0の場合、デフォルト値を使用
                        if (!value || value === '0' || value === '¥0') {
                            // HTMLのデフォルト値を再取得
                            const defaultValues = {
                                'initialFee': 1500000,
                                'equipmentFee': 3550000,
                                'cloudFee': 20000,
                                'geoWebFee': 6000,
                                'appFee': 9000,
                                'survey3dPrice': 80000,
                                'survey3dCost': 30000,
                                'vrSmallPrice': 80000,
                                'vrMediumPrice': 250000,
                                'vrLargePrice': 500000,
                                'headquarterPrice': 18000
                            };
                            value = defaultValues[id] || 0;
                        }
                        
                        const numValue = parseInt(value.toString().replace(/¥|,/g, ''));
                        if (!isNaN(numValue) && numValue > 0) {
                            input.value = '¥' + formatNumber(numValue);
                        }
                    }
                });
                
                calculate();
                calculateEditSimulation();
            }, 100);
        });
    </script>
<script defer="" src="./4DKanKan Meta導入 収益シミュレーション_files/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;version&quot;:&quot;2024.11.0&quot;,&quot;token&quot;:&quot;4edd5f8ec12a48cfa682ab8261b80a79&quot;,&quot;server_timing&quot;:{&quot;name&quot;:{&quot;cfCacheStatus&quot;:true,&quot;cfEdge&quot;:true,&quot;cfExtPri&quot;:true,&quot;cfL4&quot;:true,&quot;cfOrigin&quot;:true,&quot;cfSpeedBrain&quot;:true},&quot;location_startswith&quot;:null}}" crossorigin="anonymous"></script>


</body></html>
